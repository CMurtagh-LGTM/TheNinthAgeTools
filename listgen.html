<!DOCTYPE html>
<head>
<script type="module">
  async function init() {
    const { instance } = await WebAssembly.instantiateStreaming(
      fetch("./build_wasm/listgen.wasm"),
      {
        env: {
          log(arg) { console.log(arg); },
        },
        wasi_snapshot_preview1: {
          // TODO
          args_get() {},
          args_sizes_get() {},
          proc_exit() {}
        }
      },
      {
        builtins: ["js-string"],
      }
    );

    instance.exports._start();

    const offset = instance.exports.get_offset();
    const size = instance.exports.get_used();

    console.log(offset, size);

    const buffer = new Int32Array(instance.exports.memory.buffer, offset, size);
    let s = "";
    for (let i = 0; i < size; ++i) {
        s += String.fromCharCode(buffer[i]);
    }
    console.log(s);

    document.getElementById("content").innerHTML = s;
  }
  init();
</script>
</head>
<body>
<div id="content"/>
</body>
