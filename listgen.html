<!DOCTYPE html>
<head>
<script type="module">
  async function init() {
    const { instance } = await WebAssembly.instantiateStreaming(
      fetch("./listgen.wasm"),
      {
        env: {
            log(arg) { console.log(arg); },
        },
      },
      {
        builtins: ["js-string"],
      }
    );

    instance.exports.listgen();

    const offset = instance.exports.get_offset();
    const size = instance.exports.get_used();

    const buffer = new Int32Array(instance.exports.memory.buffer, offset, size);
    let s = "";
    for (let i = 0; i < size; ++i) {
        s += String.fromCharCode(buffer[i]);
    }
    console.log(s);

    document.getElementById("content").innerHTML = s;
  }
  init();
</script>
</head>
<body>
<div id="content"/>
</body>
